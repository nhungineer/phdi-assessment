<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planetary Health Diet Index Assessment</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåè</text></svg>">
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function PHDIQuestionnaire() {
        const [dietaryPattern, setDietaryPattern] = useState("balanced");
        const [formData, setFormData] = useState({
          fruits: "",
          vegetables: "",
          wholeGrains: "",
          soyLegumes: "",
          nonSoyLegumes: "",
          nutsSeeds: "",
          redMeat: "",
          chicken: "",
          fish: "",
          eggs: "",
          dairy: "",
          vegetableOils: "",
          saturatedFats: "",
          potatoes: "",
          addedSugars: "",
        });

        // EER (Estimated Energy Requirements) optional fields
        const [useCustomEER, setUseCustomEER] = useState(false);
        const [eerData, setEerData] = useState({
          birthYear: "",
          gender: "",
          weight: "",
          height: "",
          activityLevel: "",
        });

        const [results, setResults] = useState(null);
        const [assessmentHistory, setAssessmentHistory] = useState([]);
        const [showHistory, setShowHistory] = useState(false);

        // Load history on mount
        useEffect(() => {
          const saved = localStorage.getItem("phdi_assessments");
          if (saved) {
            try {
              setAssessmentHistory(JSON.parse(saved));
            } catch (e) {
              console.error("Error loading history:", e);
            }
          }
        }, []);

        const handleChange = (field, value) => {
          setFormData((prev) => ({ ...prev, [field]: value }));
        };

        const handlePatternChange = (newPattern) => {
          const hasData = Object.values(formData).some((value) => value !== "");

          if (hasData) {
            if (
              confirm(
                "Changing dietary pattern will clear all your current selections. Continue?"
              )
            ) {
              setDietaryPattern(newPattern);
              setFormData({
                fruits: "",
                vegetables: "",
                wholeGrains: "",
                soyLegumes: "",
                nonSoyLegumes: "",
                nutsSeeds: "",
                redMeat: "",
                chicken: "",
                fish: "",
                eggs: "",
                dairy: "",
                vegetableOils: "",
                saturatedFats: "",
                potatoes: "",
                addedSugars: "",
              });
              setResults(null);
            }
          } else {
            setDietaryPattern(newPattern);
          }
        };

        const handleReset = () => {
          setFormData({
            fruits: "",
            vegetables: "",
            wholeGrains: "",
            soyLegumes: "",
            nonSoyLegumes: "",
            nutsSeeds: "",
            redMeat: "",
            chicken: "",
            fish: "",
            eggs: "",
            dairy: "",
            vegetableOils: "",
            saturatedFats: "",
            potatoes: "",
            addedSugars: "",
          });
          setUseCustomEER(false);
          setEerData({
            birthYear: "",
            gender: "",
            weight: "",
            height: "",
            activityLevel: "",
          });
          setResults(null);
        };

        // Calculate EER using Mifflin-St Jeor equation
        const calculateEER = () => {
          if (
            !useCustomEER ||
            !eerData.birthYear ||
            !eerData.gender ||
            !eerData.weight ||
            !eerData.height ||
            !eerData.activityLevel
          ) {
            return {
              eer: 2373,
              scaleFactor: 1,
              isCapped: false,
              isDefault: true,
            };
          }

          const currentYear = new Date().getFullYear();
          const age = currentYear - parseInt(eerData.birthYear);
          const weight = parseFloat(eerData.weight);
          const height = parseFloat(eerData.height);

          // Mifflin-St Jeor BMR calculation
          let bmr;
          if (eerData.gender === "male") {
            bmr = 10 * weight + 6.25 * height - 5 * age + 5;
          } else {
            // female
            bmr = 10 * weight + 6.25 * height - 5 * age - 161;
          }

          // Activity multiplier
          const activityMultipliers = {
            sedentary: 1.2,
            lightly_active: 1.375,
            moderately_active: 1.55,
            very_active: 1.725,
            super_active: 1.9,
          };

          const eer = bmr * activityMultipliers[eerData.activityLevel];
          let scaleFactor = eer / 2373;
          let isCapped = false;

          // Cap scale factor between 0.5 and 2.0
          if (scaleFactor < 0.5) {
            scaleFactor = 0.5;
            isCapped = true;
          } else if (scaleFactor > 2.0) {
            scaleFactor = 2.0;
            isCapped = true;
          }

          return {
            eer: Math.round(eer),
            scaleFactor,
            isCapped,
            isDefault: false,
          };
        };

        // Pattern-specific targets based on EAT-Lancet Table DP1
        const dietaryTargets = {
          balanced: {
            wholeGrains: 75, // 196g total / 7 * 100g servings per week = ~75g/day target
            vegetables: 300,
            fruits: 200,
            nutsSeeds: 50,
            legumes: 75, // Combined soy (50g) + non-soy (25g) from original
            dairy: 250,
            chicken: 30,
            fish: 28,
            eggs: 13,
            redMeat: 15,
            vegetableOils: 46,
            saturatedFats: 0,
            potatoes: 50,
            addedSugars: 30,
          },
          pescatarian: {
            wholeGrains: 75,
            vegetables: 350,
            fruits: 250,
            nutsSeeds: 50,
            legumes: 80,
            dairy: 250,
            chicken: 0,
            fish: 30,
            eggs: 15,
            redMeat: 0,
            vegetableOils: 49,
            saturatedFats: 0,
            potatoes: 50,
            addedSugars: 30,
          },
          vegetarian: {
            wholeGrains: 75,
            vegetables: 375,
            fruits: 275,
            nutsSeeds: 50,
            legumes: 85,
            dairy: 250,
            chicken: 0,
            fish: 0,
            eggs: 15,
            redMeat: 0,
            vegetableOils: 49,
            saturatedFats: 0,
            potatoes: 50,
            addedSugars: 30,
          },
          vegan: {
            wholeGrains: 75,
            vegetables: 500,
            fruits: 300,
            nutsSeeds: 50,
            legumes: 100,
            dairy: 0,
            chicken: 0,
            fish: 0,
            eggs: 0,
            redMeat: 0,
            vegetableOils: 54,
            saturatedFats: 0,
            potatoes: 50,
            addedSugars: 30,
          },
        };

        const calculateScore = () => {
          const scores = {};
          const baseTargets = dietaryTargets[dietaryPattern];

          // Calculate EER and scale factor
          const { eer, scaleFactor, isCapped, isDefault } = calculateEER();

          // Scale all targets based on EER
          const targets = {};
          for (const [key, value] of Object.entries(baseTargets)) {
            targets[key] = value * scaleFactor;
          }

          // Based on PHDI (Planetary Health Diet Index) 2024 scoring methodology
          // Using EAT-Lancet 2025 reference diet for 2373 kcal/day
          // Source: https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(25)01201-2/fulltext

          // Helper function: Linear scoring between two points
          const linearScore = (value, minVal, maxVal, minScore, maxScore) => {
            if (value <= minVal) return minScore;
            if (value >= maxVal) return maxScore;
            return (
              minScore +
              ((value - minVal) / (maxVal - minVal)) * (maxScore - minScore)
            );
          };

          // OPTIMUM COMPONENTS (more is better - 0 points at 0g, 10 points at target)

          // 1. Whole grains: 100g serving per week
          const wholeGrainsFreq = parseFloat(formData.wholeGrains) || 0;
          const wholeGrainsPerDay = (wholeGrainsFreq * 100) / 7;
          scores.wholeGrains = Math.min(
            10,
            linearScore(wholeGrainsPerDay, 0, targets.wholeGrains, 0, 10)
          );

          // 3. Vegetables: 100g serving per day
          const vegFreq = parseFloat(formData.vegetables) || 0;
          const vegPerDay = vegFreq * 100;
          scores.vegetables = Math.min(
            10,
            linearScore(vegPerDay, 0, targets.vegetables, 0, 10)
          );

          // 4. Fruits: 125g serving per day (100-150g range)
          const fruitsFreq = parseFloat(formData.fruits) || 0;
          const fruitsPerDay = fruitsFreq * 125;
          scores.fruits = Math.min(
            10,
            linearScore(fruitsPerDay, 0, targets.fruits, 0, 10)
          );

          // 5. Nuts: 30g serving per day
          const nutsFreq = parseFloat(formData.nutsSeeds) || 0;
          const nutsPerDay = nutsFreq * 30;
          scores.nutsSeeds = Math.min(
            10,
            linearScore(nutsPerDay, 0, targets.nutsSeeds, 0, 10)
          );

          // 6. Soy legumes: 100g serving (weight 0.5)
          const soyFreq = parseFloat(formData.soyLegumes) || 0;
          const soyPerDay = (soyFreq * 100) / 7;
          scores.soyLegumes = Math.min(
            10,
            linearScore(soyPerDay, 0, targets.legumes * 0.67, 0, 10)
          );

          // 7. Non-soy legumes: 75g serving (weight 0.5)
          // PHDI 2024: 0g = 0pts, 100g/day = 10pts
          const nonSoyFreq = parseFloat(formData.nonSoyLegumes) || 0;
          const nonSoyPerDay = (nonSoyFreq * 75) / 7;
          scores.nonSoyLegumes = Math.min(
            10,
            linearScore(nonSoyPerDay, 0, 100 * scaleFactor, 0, 10)
          );

          // 13. Unsaturated plant oils: 30g per serving
          const oilServings = parseFloat(formData.vegetableOils) || 0;
          const oilPerDay = oilServings * 30;
          scores.vegetableOils = Math.min(
            10,
            linearScore(oilPerDay, 10, targets.vegetableOils + 10, 0, 10)
          );

          // MODERATE COMPONENTS (less is better - 10 points at target or below, 0 at excessive)

          // 2. Tubers: 150g serving per week
          const potatoesFreq = parseFloat(formData.potatoes) || 0;
          const potatoesPerDay = (potatoesFreq * 150) / 7;
          scores.potatoes = Math.max(
            0,
            linearScore(potatoesPerDay, targets.potatoes, 200, 10, 0)
          );

          // 8. Dairy: 1 serving = 1 cup milk/200g yogurt/40g cheese
          const dairyFreq = parseFloat(formData.dairy) || 0;
          const dairyPerDay = (dairyFreq * 250) / 7; // Assuming average 250g per serving
          if (targets.dairy === 0) {
            // Vegan: 10 points for no dairy, 0 points for excessive
            scores.dairy = Math.max(0, linearScore(dairyPerDay, 0, 500, 10, 0));
          } else {
            scores.dairy = Math.max(
              0,
              linearScore(dairyPerDay, targets.dairy, 1000, 10, 0)
            );
          }

          // 9. Chicken: 100g serving
          // PHDI 2024: ‚â§29g/day = 10pts, ‚â•58g/day = 0pts
          const chickenFreq = parseFloat(formData.chicken) || 0;
          const chickenPerDay = (chickenFreq * 100) / 7;
          if (targets.chicken === 0) {
            // Pescatarian/Vegetarian/Vegan: 10 points for no chicken, 0 for excessive
            scores.chicken = Math.max(
              0,
              linearScore(chickenPerDay, 0, 58 * scaleFactor, 10, 0)
            );
          } else {
            scores.chicken = Math.max(
              0,
              linearScore(chickenPerDay, 29 * scaleFactor, 58 * scaleFactor, 10, 0)
            );
          }

          // 11. Eggs: 50g per egg
          // PHDI 2024: ‚â§12g/day = 10pts, ‚â•120g/day = 0pts
          const eggsFreq = parseFloat(formData.eggs) || 0;
          const eggsPerDay = (eggsFreq * 50) / 7;
          if (targets.eggs === 0) {
            // Vegan: 10 points for no eggs, 0 for excessive
            scores.eggs = Math.max(0, linearScore(eggsPerDay, 0, 120 * scaleFactor, 10, 0));
          } else {
            scores.eggs = Math.max(
              0,
              linearScore(eggsPerDay, 12 * scaleFactor, 120 * scaleFactor, 10, 0)
            );
          }

          // 10. Fish: 100g serving per week (MODERATION - less is better)
          // PHDI 2024: ‚â§15g/day = 10pts, ‚â•50g/day = 0pts
          const fishFreq = parseFloat(formData.fish) || 0;
          const fishPerDay = (fishFreq * 100) / 7;
          if (targets.fish === 0) {
            // Vegetarian/Vegan: 10 points for no fish
            scores.fish = 10;
          } else {
            // Less fish = better score (‚â§15g=10pts, ‚â•50g=0pts)
            scores.fish = Math.max(0, linearScore(fishPerDay, 15, 50, 10, 0));
          }

          // 12. Red meat: 100g serving
          // PHDI 2024: ‚â§14g/day = 10pts, ‚â•300g/day = 0pts
          const redMeatFreq = parseFloat(formData.redMeat) || 0;
          const redMeatPerDay = (redMeatFreq * 100) / 7;
          if (targets.redMeat === 0) {
            // Pescatarian/Vegetarian/Vegan: 10 points for no red meat, 0 for excessive
            scores.redMeat = Math.max(
              0,
              linearScore(redMeatPerDay, 0, 300 * scaleFactor, 10, 0)
            );
          } else {
            scores.redMeat = Math.max(
              0,
              linearScore(redMeatPerDay, 14 * scaleFactor, 300 * scaleFactor, 10, 0)
            );
          }

          // 14. Saturated fats: 10g per serving
          const saturatedServings = parseFloat(formData.saturatedFats) || 0;
          const saturatedPerDay = saturatedServings * 10;
          scores.saturatedFats = Math.max(
            0,
            linearScore(saturatedPerDay, targets.saturatedFats, 30, 10, 0)
          );

          // 15. Added sugar: 30g per serving
          const sugarsServings = parseFloat(formData.addedSugars) || 0;
          const sugarsPerDay = sugarsServings * 30; // Already per day
          scores.addedSugars = Math.max(
            0,
            linearScore(sugarsPerDay, targets.addedSugars, 150, 10, 0)
          );

          // Calculate total score with weights (legumes are 0.5 each, others are 1)
          const totalScore =
            scores.wholeGrains +
            scores.potatoes +
            scores.vegetables +
            scores.fruits +
            scores.nutsSeeds +
            scores.soyLegumes * 0.5 +
            scores.nonSoyLegumes * 0.5 +
            scores.dairy +
            scores.chicken +
            scores.fish +
            scores.eggs +
            scores.redMeat +
            scores.vegetableOils +
            scores.saturatedFats +
            scores.addedSugars;
          const percentage = (totalScore / 140) * 100;

          // Get interpretation
          let interpretation = "";
          if (percentage >= 100) {
            interpretation =
              "Excellent! Your diet aligns well with planetary health guidelines.";
          } else if (percentage >= 75) {
            interpretation =
              "Good progress! You're making healthy and sustainable choices.";
          } else if (percentage >= 60) {
            interpretation =
              "You're around average. There's room to improve for both your health and the planet.";
          } else if (percentage >= 45) {
            interpretation =
              "Your diet could use some adjustments to be healthier and more sustainable.";
          } else {
            interpretation =
              "Significant changes would benefit both your health and the environment.";
          }

          // Get top improvement areas
          // Recommendations based on EAT-Lancet 2025 targets and PHDI 2024 scoring
          // Pattern-specific recommendations
          const vegTargetText =
            dietaryPattern === "balanced"
              ? "3+"
              : dietaryPattern === "pescatarian"
              ? "3.5+"
              : dietaryPattern === "vegetarian"
              ? "~4"
              : "5";
          const fruitTargetText =
            dietaryPattern === "balanced"
              ? "2"
              : dietaryPattern === "pescatarian"
              ? "2"
              : dietaryPattern === "vegetarian"
              ? "2+"
              : "2.5";
          const legumeImportance =
            dietaryPattern === "vegan"
              ? "IMPORTANT protein source - aim for higher intake"
              : "Key plant protein source";

          const componentDetails = [
            {
              name: "Whole Grains",
              score: scores.wholeGrains,
              max: 10,
              emoji: "üåæ",
              rec: "Aim for 1-2 servings (100g each) daily - brown rice, whole wheat bread, oatmeal",
            },
            {
              name: "Tubers/Potatoes",
              score: scores.potatoes,
              max: 10,
              emoji: "ü•î",
              rec: "Limit to ~1 serving (50g) per week - too much reduces score",
            },
            {
              name: "Vegetables",
              score: scores.vegetables,
              max: 10,
              emoji: "ü•ó",
              rec: `Aim for ${vegTargetText} servings (100g each) daily - half your plate at meals`,
            },
            {
              name: "Fruits",
              score: scores.fruits,
              max: 10,
              emoji: "üçé",
              rec: `Aim for ${fruitTargetText} servings (125g each) daily - berries, apples, citrus`,
            },
            {
              name: "Nuts and Seeds",
              score: scores.nutsSeeds,
              max: 10,
              emoji: "ü•ú",
              rec: "Eat 1 serving (30g) daily - almonds, walnuts, pumpkin seeds",
            },
            {
              name: "Soy Legumes",
              score: scores.soyLegumes * 0.5,
              max: 5,
              emoji: "ü´õ",
              rec: `${legumeImportance} - tofu, tempeh, edamame, soy milk 3-4x/week (100g per serving)`,
            },
            {
              name: "Non-Soy Legumes",
              score: scores.nonSoyLegumes * 0.5,
              max: 5,
              emoji: "ü´ò",
              rec: `${legumeImportance} - beans, lentils, chickpeas, peas ${
                dietaryPattern === "vegan" ? "daily or more" : "daily"
              } (75g per serving)`,
            },
            {
              name: "Dairy",
              score: scores.dairy,
              max: 10,
              emoji: "ü•õ",
              rec:
                dietaryPattern === "vegan"
                  ? "Not included in vegan diet - use fortified plant milks for calcium"
                  : "Aim for 1 serving daily - 1 cup milk OR 40g cheese OR 200g yogurt",
            },
            {
              name: "Chicken/Poultry",
              score: scores.chicken,
              max: 10,
              emoji: "üçó",
              rec:
                dietaryPattern === "balanced"
                  ? "Limit to ~2 servings (100g) per week or less"
                  : "Not included in your dietary pattern",
            },
            {
              name: "Fish/Seafood",
              score: scores.fish,
              max: 10,
              emoji: "üêü",
              rec:
                dietaryPattern === "balanced" ||
                dietaryPattern === "pescatarian"
                  ? "Aim for 2 servings (100g each) per week - salmon, sardines, mackerel"
                  : "Not included in your dietary pattern",
            },
            {
              name: "Eggs",
              score: scores.eggs,
              max: 10,
              emoji: "ü•ö",
              rec:
                dietaryPattern === "vegan"
                  ? "Not included in vegan diet"
                  : "Limit to ~2 eggs per week or less",
            },
            {
              name: "Red Meat",
              score: scores.redMeat,
              max: 10,
              emoji: "ü•©",
              rec:
                dietaryPattern === "balanced"
                  ? "Limit to ~1 serving (100g) per week or less"
                  : "Not included in your dietary pattern",
            },
            {
              name: "Vegetable Oils",
              score: scores.vegetableOils,
              max: 10,
              emoji: "ü´í",
              rec:
                dietaryPattern === "vegan"
                  ? "Important for calories - use olive/canola oil ~2x daily"
                  : "Use olive/canola oil for cooking ~2 times daily (30g per use)",
            },
            {
              name: "Saturated Fats",
              score: scores.saturatedFats,
              max: 10,
              emoji: "üßà",
              rec: "Minimize saturated fats - avoid butter, palm oil, coconut oil, lard",
            },
            {
              name: "Added Sugars",
              score: scores.addedSugars,
              max: 10,
              emoji: "üç¨",
              rec: "Minimize sugary foods/drinks - limit to ~1 serving (30g sugar) per day",
            },
          ];

          // Calculate percentage for each component
          const componentsWithPercent = componentDetails.map((comp) => ({
            ...comp,
            percentage: (comp.score / comp.max) * 100,
          }));

          // Sort by percentage (lowest first) and take top 5
          const topImprovements = componentsWithPercent
            .filter((comp) => comp.percentage < 80) // Only show if less than 80%
            .sort((a, b) => a.percentage - b.percentage)
            .slice(0, 5);

          const resultsObj = {
            totalScore: Math.round(totalScore * 10) / 10,
            percentage: Math.round(percentage * 10) / 10,
            interpretation,
            scores,
            componentDetails: componentsWithPercent,
            topImprovements,
            dietaryPattern: dietaryPattern,
            eer: eer,
            scaleFactor: scaleFactor,
            isCapped: isCapped,
            isDefaultEER: isDefault,
            eerData: useCustomEER ? { ...eerData } : null,
          };

          setResults(resultsObj);

          // Save to localStorage
          saveAssessment(resultsObj);

          // Scroll to results
          setTimeout(() => {
            document
              .getElementById("results-section")
              ?.scrollIntoView({ behavior: "smooth" });
          }, 100);
        };

        const saveAssessment = (resultsObj) => {
          const assessment = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            formData: { ...formData },
            results: resultsObj,
          };

          const history = [...assessmentHistory, assessment];
          setAssessmentHistory(history);
          localStorage.setItem("phdi_assessments", JSON.stringify(history));
        };

        const exportAsJSON = () => {
          if (!results) return;

          const latestAssessment =
            assessmentHistory[assessmentHistory.length - 1];
          const dataStr = JSON.stringify(latestAssessment, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `phdi-assessment-${
            new Date().toISOString().split("T")[0]
          }.json`;
          link.click();
          URL.revokeObjectURL(url);
        };

        const exportForLLM = () => {
          if (!results) return;

          const latestAssessment =
            assessmentHistory[assessmentHistory.length - 1];

          // Create LLM-friendly summary
          const llmPrompt = `PLANETARY HEALTH DIET INDEX ASSESSMENT RESULTS
      Date: ${new Date(latestAssessment.timestamp).toLocaleDateString()}

      DIETARY PATTERN: ${
        results.dietaryPattern.charAt(0).toUpperCase() +
        results.dietaryPattern.slice(1)
      }

      ${
        results.isDefaultEER
          ? `ENERGY REQUIREMENTS: 2,373 kcal/day (standard EAT-Lancet reference)`
          : `PERSONALIZED ENERGY REQUIREMENTS: ${results.eer.toLocaleString()} kcal/day (scale factor: ${results.scaleFactor.toFixed(
              2
            )}√ó)${results.isCapped ? " [capped for safety]" : ""}`
      }

      OVERALL SCORE: ${results.totalScore}/140 (${
            results.percentage
          }% alignment)
      Interpretation: ${results.interpretation}

      DIETARY INTAKE (servings):
      - Whole grains: ${formData.wholeGrains} per week
      - Tubers/potatoes: ${formData.potatoes} per week
      - Vegetables: ${formData.vegetables} per day
      - Fruits: ${formData.fruits} per day
      - Nuts: ${formData.nutsSeeds} per day
      - Soy legumes: ${formData.soyLegumes} per week
      - Non-soy legumes: ${formData.nonSoyLegumes} per week
      - Dairy: ${formData.dairy} per week
      - Chicken: ${formData.chicken} per week
      - Fish: ${formData.fish} per week
      - Eggs: ${formData.eggs} per week
      - Red meat: ${formData.redMeat} per week
      - Vegetable oils: ${formData.vegetableOils} per day
      - Saturated fats: ${formData.saturatedFats} per day
      - Added sugars: ${formData.addedSugars} per day

      COMPONENT SCORES:
      ${results.componentDetails
        .map(
          (c) =>
            `- ${c.name}: ${c.score.toFixed(1)}/${
              c.max
            } (${c.percentage.toFixed(0)}%)`
        )
        .join("\n")}

      TOP IMPROVEMENT AREAS:
      ${
        results.topImprovements.length > 0
          ? results.topImprovements
              .map(
                (item, i) =>
                  `${i + 1}. ${item.name} (${item.score.toFixed(1)}/${
                    item.max
                  }): ${item.rec}`
              )
              .join("\n")
          : "All areas are performing well!"
      }

      Based on this assessment, please provide personalized coaching to help me improve my diet alignment with EAT-Lancet planetary health guidelines.`;

          const dataBlob = new Blob([llmPrompt], { type: "text/plain" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `phdi-llm-prompt-${
            new Date().toISOString().split("T")[0]
          }.txt`;
          link.click();
          URL.revokeObjectURL(url);
        };

        const copyForLLM = () => {
          if (!results) return;

          const latestAssessment =
            assessmentHistory[assessmentHistory.length - 1];

          const llmPrompt = `PLANETARY HEALTH DIET INDEX ASSESSMENT RESULTS
      Date: ${new Date(latestAssessment.timestamp).toLocaleDateString()}

      DIETARY PATTERN: ${
        results.dietaryPattern.charAt(0).toUpperCase() +
        results.dietaryPattern.slice(1)
      }

      ${
        results.isDefaultEER
          ? `ENERGY REQUIREMENTS: 2,373 kcal/day (standard EAT-Lancet reference)`
          : `PERSONALIZED ENERGY REQUIREMENTS: ${results.eer.toLocaleString()} kcal/day (scale factor: ${results.scaleFactor.toFixed(
              2
            )}√ó)${results.isCapped ? " [capped for safety]" : ""}`
      }

      OVERALL SCORE: ${results.totalScore}/140 (${
            results.percentage
          }% alignment)
      Interpretation: ${results.interpretation}

      DIETARY INTAKE (servings):
      - Whole grains: ${formData.wholeGrains} per week
      - Tubers/potatoes: ${formData.potatoes} per week
      - Vegetables: ${formData.vegetables} per day
      - Fruits: ${formData.fruits} per day
      - Nuts: ${formData.nutsSeeds} per day
      - Soy legumes: ${formData.soyLegumes} per week
      - Non-soy legumes: ${formData.nonSoyLegumes} per week
      - Dairy: ${formData.dairy} per week
      - Chicken: ${formData.chicken} per week
      - Fish: ${formData.fish} per week
      - Eggs: ${formData.eggs} per week
      - Red meat: ${formData.redMeat} per week
      - Vegetable oils: ${formData.vegetableOils} per day
      - Saturated fats: ${formData.saturatedFats} per day
      - Added sugars: ${formData.addedSugars} per day

      COMPONENT SCORES:
      ${results.componentDetails
        .map(
          (c) =>
            `- ${c.name}: ${c.score.toFixed(1)}/${
              c.max
            } (${c.percentage.toFixed(0)}%)`
        )
        .join("\n")}

      TOP IMPROVEMENT AREAS:
      ${
        results.topImprovements.length > 0
          ? results.topImprovements
              .map(
                (item, i) =>
                  `${i + 1}. ${item.name} (${item.score.toFixed(1)}/${
                    item.max
                  }): ${item.rec}`
              )
              .join("\n")
          : "All areas are performing well!"
      }

      Based on this assessment, please provide personalized coaching to help me improve my diet alignment with EAT-Lancet planetary health guidelines.`;

          navigator.clipboard
            .writeText(llmPrompt)
            .then(() => {
              alert(
                "Assessment summary copied to clipboard! Paste it into Claude or ChatGPT."
              );
            })
            .catch((err) => {
              console.error("Failed to copy:", err);
              alert("Failed to copy. Please use the Download option instead.");
            });
        };

        const clearAllData = () => {
          if (
            confirm(
              "Are you sure you want to delete all saved assessments? This cannot be undone."
            )
          ) {
            localStorage.removeItem("phdi_assessments");
            setAssessmentHistory([]);
            alert("All data cleared.");
          }
        };

        const getScoreColor = (score, max) => {
          const percentage = (score / max) * 100;
          if (percentage >= 80) return "text-green-600";
          if (percentage >= 40) return "text-yellow-600";
          return "text-red-600";
        };

        const getScoreBgColor = (score, max) => {
          const percentage = (score / max) * 100;
          if (percentage >= 80) return "bg-green-100";
          if (percentage >= 40) return "bg-yellow-100";
          return "bg-red-100";
        };

        const isFormValid = () => {
          // Define required fields based on dietary pattern
          const requiredFields = [
            "fruits",
            "vegetables",
            "wholeGrains",
            "soyLegumes",
            "nonSoyLegumes",
            "nutsSeeds",
            "potatoes",
            "vegetableOils",
            "saturatedFats",
            "addedSugars",
          ];

          // Add animal product fields based on pattern
          if (dietaryPattern === "balanced") {
            requiredFields.push("redMeat", "chicken", "fish", "eggs", "dairy");
          } else if (dietaryPattern === "pescatarian") {
            requiredFields.push("fish", "eggs", "dairy");
          } else if (dietaryPattern === "vegetarian") {
            requiredFields.push("eggs", "dairy");
          }
          // vegan: no animal products needed

          const allFilled = requiredFields.every(
            (field) => formData[field] !== ""
          );
          // Debug: log missing fields
          if (!allFilled) {
            const missingFields = requiredFields.filter(
              (field) => formData[field] === ""
            );
            console.log("Missing fields:", missingFields);
          }
          return allFilled;
        };

        const getIncompleteSections = () => {
          const section1Fields = [
            "fruits",
            "vegetables",
            "wholeGrains",
            "soyLegumes",
            "nonSoyLegumes",
            "nutsSeeds",
          ];
          const section3Fields = [
            "potatoes",
            "vegetableOils",
            "saturatedFats",
            "addedSugars",
          ];

          // Section 2 fields vary by dietary pattern
          let section2Fields = [];
          if (dietaryPattern === "balanced") {
            section2Fields = ["redMeat", "chicken", "fish", "eggs", "dairy"];
          } else if (dietaryPattern === "pescatarian") {
            section2Fields = ["fish", "eggs", "dairy"];
          } else if (dietaryPattern === "vegetarian") {
            section2Fields = ["eggs", "dairy"];
          } // vegan has no animal products, so empty array

          const sections = [];
          if (section1Fields.some((field) => formData[field] === ""))
            sections.push("Plant-Based Foods");
          if (
            section2Fields.length > 0 &&
            section2Fields.some((field) => formData[field] === "")
          )
            sections.push("Animal Products");
          if (section3Fields.some((field) => formData[field] === ""))
            sections.push("Fats & Other");
          return sections;
        };

        const isSectionComplete = (section) => {
          const section1Fields = [
            "fruits",
            "vegetables",
            "wholeGrains",
            "soyLegumes",
            "nonSoyLegumes",
            "nutsSeeds",
          ];
          const section3Fields = [
            "potatoes",
            "vegetableOils",
            "saturatedFats",
            "addedSugars",
          ];

          // Section 2 fields vary by dietary pattern
          let section2Fields = [];
          if (dietaryPattern === "balanced") {
            section2Fields = ["redMeat", "chicken", "fish", "eggs", "dairy"];
          } else if (dietaryPattern === "pescatarian") {
            section2Fields = ["fish", "eggs", "dairy"];
          } else if (dietaryPattern === "vegetarian") {
            section2Fields = ["eggs", "dairy"];
          } // vegan has no animal products, so empty array

          if (section === 1)
            return section1Fields.every((field) => formData[field] !== "");
          if (section === 2)
            return (
              section2Fields.length === 0 ||
              section2Fields.every((field) => formData[field] !== "")
            );
          if (section === 3)
            return section3Fields.every((field) => formData[field] !== "");
          return false;
        };

        return (
          <div className="min-h-screen py-8 px-4">
            <div className="max-w-4xl mx-auto">
              {/* Header */}
              <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                <div className="flex justify-between items-start mb-3">
                  <h1 className="text-3xl font-bold text-gray-800">
                    Planetary Health Diet Index Assessment
                  </h1>
                  {assessmentHistory.length > 0 && (
                    <button
                      onClick={() => setShowHistory(true)}
                      className="text-sm text-blue-600 hover:text-blue-800 underline"
                    >
                      View History ({assessmentHistory.length})
                    </button>
                  )}
                </div>
                <p className="text-gray-600 leading-relaxed">
                  The Planetary Health Diet Index assesses how well your diet
                  aligns with the{" "}
                  <a
                    href="https://www.thelancet.com/commissions-do/EAT-2025"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-blue-600 font-semibold underline hover:text-blue-800 transition-colors"
                  >
                    2025 EAT-Lancet Commission
                  </a>
                  's recommendations for healthy, sustainable eating that
                  supports both human health and planetary health.
                </p>
              </div>

              {/* Previous Assessment Banner */}
              {assessmentHistory.length > 0 && !results && (
                <div className="bg-blue-50 border-l-4 border-blue-400 rounded-lg p-4 mb-6">
                  <div className="flex items-start">
                    <span className="text-blue-600 text-xl mr-3">‚ÑπÔ∏è</span>
                    <div className="flex-1">
                      <p className="text-blue-800 font-semibold mb-1">
                        Previous Assessment Found
                      </p>
                      <p className="text-blue-700 text-sm">
                        Last completed:{" "}
                        {new Date(
                          assessmentHistory[
                            assessmentHistory.length - 1
                          ].timestamp
                        ).toLocaleString()}
                        {" ‚Ä¢ "}
                        Score:{" "}
                        {
                          assessmentHistory[assessmentHistory.length - 1]
                            .results.totalScore
                        }
                        /140 (
                        {
                          assessmentHistory[assessmentHistory.length - 1]
                            .results.percentage
                        }
                        %)
                      </p>
                    </div>
                  </div>
                </div>
              )}

              {/* Dietary Pattern Selector */}
              <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 className="text-xl font-bold text-gray-800 mb-3">
                  Select Your Dietary Pattern
                </h2>
                <p className="text-sm text-gray-600 mb-4">
                  Choose the pattern that best matches your diet. Each pattern
                  has different optimal targets based on EAT-Lancet guidelines.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <label
                    className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
                      dietaryPattern === "balanced"
                        ? "border-green-500 bg-green-50"
                        : "border-gray-200 hover:border-green-300"
                    }`}
                  >
                    <input
                      type="radio"
                      name="dietaryPattern"
                      value="balanced"
                      checked={dietaryPattern === "balanced"}
                      onChange={(e) => handlePatternChange(e.target.value)}
                      className="mr-3"
                    />
                    <span className="font-semibold text-gray-800">
                      Balanced (All Foods in Moderation)
                    </span>
                    <p className="text-sm text-gray-600 ml-6 mt-1">
                      Includes all food groups with ~2 servings of animal
                      products daily
                    </p>
                  </label>

                  <label
                    className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
                      dietaryPattern === "pescatarian"
                        ? "border-green-500 bg-green-50"
                        : "border-gray-200 hover:border-green-300"
                    }`}
                  >
                    <input
                      type="radio"
                      name="dietaryPattern"
                      value="pescatarian"
                      checked={dietaryPattern === "pescatarian"}
                      onChange={(e) => handlePatternChange(e.target.value)}
                      className="mr-3"
                    />
                    <span className="font-semibold text-gray-800">
                      Pescatarian (Fish, No Meat)
                    </span>
                    <p className="text-sm text-gray-600 ml-6 mt-1">
                      Fish/seafood, dairy, and eggs - no meat or poultry
                    </p>
                  </label>

                  <label
                    className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
                      dietaryPattern === "vegetarian"
                        ? "border-green-500 bg-green-50"
                        : "border-gray-200 hover:border-green-300"
                    }`}
                  >
                    <input
                      type="radio"
                      name="dietaryPattern"
                      value="vegetarian"
                      checked={dietaryPattern === "vegetarian"}
                      onChange={(e) => handlePatternChange(e.target.value)}
                      className="mr-3"
                    />
                    <span className="font-semibold text-gray-800">
                      Vegetarian (Dairy & Eggs, No Meat/Fish)
                    </span>
                    <p className="text-sm text-gray-600 ml-6 mt-1">
                      Plant-based with dairy and eggs
                    </p>
                  </label>

                  <label
                    className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
                      dietaryPattern === "vegan"
                        ? "border-green-500 bg-green-50"
                        : "border-gray-200 hover:border-green-300"
                    }`}
                  >
                    <input
                      type="radio"
                      name="dietaryPattern"
                      value="vegan"
                      checked={dietaryPattern === "vegan"}
                      onChange={(e) => handlePatternChange(e.target.value)}
                      className="mr-3"
                    />
                    <span className="font-semibold text-gray-800">
                      Vegan (100% Plant-Based)
                    </span>
                    <p className="text-sm text-gray-600 ml-6 mt-1">
                      No animal products
                    </p>
                  </label>
                </div>
              </div>

              {/* Questionnaire Form */}
              <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                <form
                  onSubmit={(e) => {
                    e.preventDefault();
                    calculateScore();
                  }}
                >
                  {/* Section 1: Plant-Based Foods */}
                  <div className="mb-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-green-500 flex items-center justify-between">
                      <span>Section 1: Plant-Based Foods</span>
                      {isSectionComplete(1) && (
                        <span className="text-green-600 text-lg">
                          ‚úì Complete
                        </span>
                      )}
                    </h2>

                    <div className="space-y-4">
                      {/* Whole grains */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.wholeGrains !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          üåæ Whole grains - (servings per week)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            100g per serving ‚Ä¢ muesli, rice, pasta, cereal,
                            bread
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3", value: 3 },
                            { display: "4", value: 4 },
                            { display: "5+", value: 5.5 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="wholeGrains"
                                value={option.value}
                                checked={
                                  formData.wholeGrains === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("wholeGrains", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Tubers and starchy roots */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.potatoes !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü•î Tubers and starchy roots - (servings per week)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            150g per serving ‚Ä¢ potato, cassava, sweet potato
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3", value: 3 },
                            { display: "4", value: 4 },
                            { display: "5", value: 5 },
                            { display: "6", value: 6 },
                            { display: "7+", value: 7.5 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="potatoes"
                                value={option.value}
                                checked={
                                  formData.potatoes === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("potatoes", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Vegetables */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.vegetables !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü•¨ Vegetables - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            100g per serving ‚Ä¢ lettuce, broccoli, cabbage, green
                            beans, cauliflower
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3+", value: 3 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="vegetables"
                                value={option.value}
                                checked={
                                  formData.vegetables === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("vegetables", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Fruits */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.fruits !== "" ? "bg-green-50" : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          üçä Fruits - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            100-150g per serving ‚Ä¢ apple, banana, orange,
                            grapes, melons, pineapples
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3+", value: 3 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="fruits"
                                value={option.value}
                                checked={
                                  formData.fruits === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("fruits", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Tree nuts and peanuts */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.nutsSeeds !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü•ú Tree nuts and peanuts - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            30g per serving ‚Ä¢ peanuts, hazelnuts, almonds,
                            cashew nuts, walnuts
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3+", value: 3 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="nutsSeeds"
                                value={option.value}
                                checked={
                                  formData.nutsSeeds === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("nutsSeeds", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Soy Legumes */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.soyLegumes !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü´õ Soy Legumes - (servings per week)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            100g per serving ‚Ä¢ tofu, soy beans, tempeh, soy
                            foods
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3", value: 3 },
                            { display: "4", value: 4 },
                            { display: "5+", value: 5.5 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="soyLegumes"
                                value={option.value}
                                checked={
                                  formData.soyLegumes === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("soyLegumes", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Non-soy legumes */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.nonSoyLegumes !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü´ò Non-soy legumes - (servings per week)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            75g per serving ‚Ä¢ lentils, peas, chickpeas, dry
                            beans
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3", value: 3 },
                            { display: "4", value: 4 },
                            { display: "5", value: 5 },
                            { display: "6", value: 6 },
                            { display: "7+", value: 7.5 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="nonSoyLegumes"
                                value={option.value}
                                checked={
                                  formData.nonSoyLegumes ===
                                  String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("nonSoyLegumes", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Section 2: Animal Products */}
                  {dietaryPattern !== "vegan" && (
                    <div className="mb-8">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-500 flex items-center justify-between">
                        <span>Section 2: Animal Products</span>
                        {isSectionComplete(2) && (
                          <span className="text-green-600 text-lg">
                            ‚úì Complete
                          </span>
                        )}
                      </h2>

                      <div className="space-y-4">
                        {/* Dairy */}
                        {dietaryPattern !== "vegan" && (
                          <div
                            className={`p-4 rounded-lg ${
                              formData.dairy !== ""
                                ? "bg-green-50"
                                : "bg-gray-50"
                            }`}
                          >
                            <label className="block text-gray-700 font-semibold mb-2">
                              ü•õ Dairy - (servings per week)
                              <span className="block text-sm text-gray-500 font-normal mt-1">
                                1 cup milk OR 40g cheese OR 200g yogurt per
                                serving ‚Ä¢ milk, cheese, yogurt
                              </span>
                            </label>
                            <div className="flex flex-wrap gap-3">
                              {[
                                { display: "0", value: 0 },
                                { display: "1", value: 1 },
                                { display: "2", value: 2 },
                                { display: "3", value: 3 },
                                { display: "4", value: 4 },
                                { display: "5", value: 5 },
                                { display: "6", value: 6 },
                                { display: "7+", value: 7.5 },
                              ].map((option) => (
                                <label
                                  key={option.value}
                                  className="flex items-center cursor-pointer"
                                >
                                  <input
                                    type="radio"
                                    name="dairy"
                                    value={option.value}
                                    checked={
                                      formData.dairy === String(option.value)
                                    }
                                    onChange={(e) =>
                                      handleChange("dairy", e.target.value)
                                    }
                                    className="mr-2"
                                  />
                                  <span className="text-gray-700">
                                    {option.display}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Chicken and poultry */}
                        {dietaryPattern === "balanced" && (
                          <div
                            className={`p-4 rounded-lg ${
                              formData.chicken !== ""
                                ? "bg-green-50"
                                : "bg-gray-50"
                            }`}
                          >
                            <label className="block text-gray-700 font-semibold mb-2">
                              üçó Chicken and poultry - (servings per week)
                              <span className="block text-sm text-gray-500 font-normal mt-1">
                                100g per serving ‚Ä¢ chicken breast, turkey, duck
                              </span>
                            </label>
                            <div className="flex flex-wrap gap-3">
                              {[
                                { display: "0", value: 0 },
                                { display: "1", value: 1 },
                                { display: "2", value: 2 },
                                { display: "3", value: 3 },
                                { display: "4", value: 4 },
                                { display: "5+", value: 5.5 },
                              ].map((option) => (
                                <label
                                  key={option.value}
                                  className="flex items-center cursor-pointer"
                                >
                                  <input
                                    type="radio"
                                    name="chicken"
                                    value={option.value}
                                    checked={
                                      formData.chicken === String(option.value)
                                    }
                                    onChange={(e) =>
                                      handleChange("chicken", e.target.value)
                                    }
                                    className="mr-2"
                                  />
                                  <span className="text-gray-700">
                                    {option.display}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Fish and shellfish */}
                        {(dietaryPattern === "balanced" ||
                          dietaryPattern === "pescatarian") && (
                          <div
                            className={`p-4 rounded-lg ${
                              formData.fish !== ""
                                ? "bg-green-50"
                                : "bg-gray-50"
                            }`}
                          >
                            <label className="block text-gray-700 font-semibold mb-2">
                              üêü Fish and shellfish - (servings per week)
                              <span className="block text-sm text-gray-500 font-normal mt-1">
                                100g per serving ‚Ä¢ salmon, tuna, sardines,
                                prawns
                              </span>
                            </label>
                            <div className="flex flex-wrap gap-3">
                              {[
                                { display: "0", value: 0 },
                                { display: "1", value: 1 },
                                { display: "2", value: 2 },
                                { display: "3", value: 3 },
                                { display: "4", value: 4 },
                                { display: "5+", value: 5.5 },
                              ].map((option) => (
                                <label
                                  key={option.value}
                                  className="flex items-center cursor-pointer"
                                >
                                  <input
                                    type="radio"
                                    name="fish"
                                    value={option.value}
                                    checked={
                                      formData.fish === String(option.value)
                                    }
                                    onChange={(e) =>
                                      handleChange("fish", e.target.value)
                                    }
                                    className="mr-2"
                                  />
                                  <span className="text-gray-700">
                                    {option.display}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Eggs */}
                        {dietaryPattern !== "vegan" && (
                          <div
                            className={`p-4 rounded-lg ${
                              formData.eggs !== ""
                                ? "bg-green-50"
                                : "bg-gray-50"
                            }`}
                          >
                            <label className="block text-gray-700 font-semibold mb-2">
                              ü•ö Eggs - (servings per week)
                              <span className="block text-sm text-gray-500 font-normal mt-1">
                                50g per serving (1 egg) ‚Ä¢ chicken eggs
                              </span>
                            </label>
                            <div className="flex flex-wrap gap-3">
                              {[
                                { display: "0", value: 0 },
                                { display: "1", value: 1 },
                                { display: "2", value: 2 },
                                { display: "3", value: 3 },
                                { display: "4", value: 4 },
                                { display: "5", value: 5 },
                                { display: "6", value: 6 },
                                { display: "7+", value: 7.5 },
                              ].map((option) => (
                                <label
                                  key={option.value}
                                  className="flex items-center cursor-pointer"
                                >
                                  <input
                                    type="radio"
                                    name="eggs"
                                    value={option.value}
                                    checked={
                                      formData.eggs === String(option.value)
                                    }
                                    onChange={(e) =>
                                      handleChange("eggs", e.target.value)
                                    }
                                    className="mr-2"
                                  />
                                  <span className="text-gray-700">
                                    {option.display}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Red meat */}
                        {dietaryPattern === "balanced" && (
                          <div
                            className={`p-4 rounded-lg ${
                              formData.redMeat !== ""
                                ? "bg-green-50"
                                : "bg-gray-50"
                            }`}
                          >
                            <label className="block text-gray-700 font-semibold mb-2">
                              ü•© Red meat - (servings per week)
                              <span className="block text-sm text-gray-500 font-normal mt-1">
                                100g per serving ‚Ä¢ beef, pork, lamb
                              </span>
                            </label>
                            <div className="flex flex-wrap gap-3">
                              {[
                                { display: "0", value: 0 },
                                { display: "1", value: 1 },
                                { display: "2", value: 2 },
                                { display: "3", value: 3 },
                                { display: "4", value: 4 },
                                { display: "5+", value: 5.5 },
                              ].map((option) => (
                                <label
                                  key={option.value}
                                  className="flex items-center cursor-pointer"
                                >
                                  <input
                                    type="radio"
                                    name="redMeat"
                                    value={option.value}
                                    checked={
                                      formData.redMeat === String(option.value)
                                    }
                                    onChange={(e) =>
                                      handleChange("redMeat", e.target.value)
                                    }
                                    className="mr-2"
                                  />
                                  <span className="text-gray-700">
                                    {option.display}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* Section 3: Fats & Other */}
                  <div className="mb-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-orange-500 flex items-center justify-between">
                      <span>Section 3: Fats & Other</span>
                      {isSectionComplete(3) && (
                        <span className="text-green-600 text-lg">
                          ‚úì Complete
                        </span>
                      )}
                    </h2>

                    <div className="space-y-4">
                      {/* Unsaturated plant oils */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.vegetableOils !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          ü´í Unsaturated plant oils - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            30g per serving ‚Ä¢ olive oil, vegetable oil, canola
                            oil, sunflower oil
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2+", value: 2 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="vegetableOils"
                                value={option.value}
                                checked={
                                  formData.vegetableOils ===
                                  String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("vegetableOils", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Saturated oil and transfat */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.saturatedFats !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          üßà Saturated oil and transfat - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            10g per serving ‚Ä¢ palm oil, coconut oil, lard,
                            tallow, margarine, butter
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3+", value: 3 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="saturatedFats"
                                value={option.value}
                                checked={
                                  formData.saturatedFats ===
                                  String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("saturatedFats", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* Added sugar */}
                      <div
                        className={`p-4 rounded-lg ${
                          formData.addedSugars !== ""
                            ? "bg-green-50"
                            : "bg-gray-50"
                        }`}
                      >
                        <label className="block text-gray-700 font-semibold mb-2">
                          üç¨ Added sugar - (servings per day)
                          <span className="block text-sm text-gray-500 font-normal mt-1">
                            30g per serving ‚Ä¢ added sugar or sugar from fruit
                            juice, dessert, soft drinks (1 tbsp = 4g sugar, 1
                            soft drink can = ~40g sugar)
                          </span>
                        </label>
                        <div className="flex flex-wrap gap-3">
                          {[
                            { display: "0", value: 0 },
                            { display: "1", value: 1 },
                            { display: "2", value: 2 },
                            { display: "3", value: 3 },
                            { display: "4", value: 4 },
                            { display: "5+", value: 5 },
                          ].map((option) => (
                            <label
                              key={option.value}
                              className="flex items-center cursor-pointer"
                            >
                              <input
                                type="radio"
                                name="addedSugars"
                                value={option.value}
                                checked={
                                  formData.addedSugars === String(option.value)
                                }
                                onChange={(e) =>
                                  handleChange("addedSugars", e.target.value)
                                }
                                className="mr-2"
                              />
                              <span className="text-gray-700">
                                {option.display}
                              </span>
                            </label>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Incomplete Sections Warning */}
                  {!isFormValid() && (
                    <div className="mb-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                      <div className="flex items-start">
                        <span className="text-yellow-600 text-xl mr-2">‚ö†Ô∏è</span>
                        <div>
                          <p className="text-yellow-800 font-semibold mb-1">
                            Please complete all sections to calculate your score
                          </p>
                          <p className="text-yellow-700 text-sm">
                            Incomplete sections:{" "}
                            {getIncompleteSections().join(", ")}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Optional EER Section */}
                  <div className="mb-8 p-6 bg-gray-50 rounded-lg border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h3 className="text-lg font-bold text-gray-800">
                          Customised Estimated Energy Requirements (Optional)
                        </h3>
                        <p className="text-sm text-gray-600 mt-1">
                          Your energy requirements may vary depending on age,
                          gender, BMI, and activity level. If not provided,
                          we'll use the standard EAT-Lancet estimate of 2373
                          kcal/day for a healthy and active adult with normal
                          BMI (18.5-25 kg/m¬≤).
                        </p>
                      </div>
                      <label className="flex items-center cursor-pointer ml-4">
                        <input
                          type="checkbox"
                          checked={useCustomEER}
                          onChange={(e) => setUseCustomEER(e.target.checked)}
                          className="mr-2 h-5 w-5"
                        />
                        <span className="text-sm font-semibold text-gray-700 whitespace-nowrap">
                          Enable
                        </span>
                      </label>
                    </div>

                    {useCustomEER && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        {/* Birth Year */}
                        <div>
                          <label className="block text-gray-700 font-semibold mb-2">
                            Birth Year
                          </label>
                          <select
                            value={eerData.birthYear}
                            onChange={(e) =>
                              setEerData({
                                ...eerData,
                                birthYear: e.target.value,
                              })
                            }
                            className="w-full p-2 border border-gray-300 rounded-lg"
                          >
                            <option value="">Select year</option>
                            {Array.from({ length: 97 }, (_, i) => 2020 - i).map(
                              (year) => (
                                <option key={year} value={year}>
                                  {year}
                                </option>
                              )
                            )}
                          </select>
                        </div>

                        {/* Gender at Birth */}
                        <div>
                          <label className="block text-gray-700 font-semibold mb-2">
                            Gender at Birth
                          </label>
                          <select
                            value={eerData.gender}
                            onChange={(e) =>
                              setEerData({ ...eerData, gender: e.target.value })
                            }
                            className="w-full p-2 border border-gray-300 rounded-lg"
                          >
                            <option value="">Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                          </select>
                        </div>

                        {/* Weight */}
                        <div>
                          <label className="block text-gray-700 font-semibold mb-2">
                            Weight (kg)
                          </label>
                          <input
                            type="number"
                            min="20"
                            max="300"
                            step="0.1"
                            value={eerData.weight}
                            onChange={(e) =>
                              setEerData({ ...eerData, weight: e.target.value })
                            }
                            className="w-full p-2 border border-gray-300 rounded-lg"
                            placeholder="e.g., 70"
                          />
                        </div>

                        {/* Height */}
                        <div>
                          <label className="block text-gray-700 font-semibold mb-2">
                            Height (cm)
                          </label>
                          <input
                            type="number"
                            min="100"
                            max="250"
                            step="0.1"
                            value={eerData.height}
                            onChange={(e) =>
                              setEerData({ ...eerData, height: e.target.value })
                            }
                            className="w-full p-2 border border-gray-300 rounded-lg"
                            placeholder="e.g., 170"
                          />
                        </div>

                        {/* Activity Level */}
                        <div className="md:col-span-2">
                          <label className="block text-gray-700 font-semibold mb-2">
                            Activity Level
                          </label>
                          <select
                            value={eerData.activityLevel}
                            onChange={(e) =>
                              setEerData({
                                ...eerData,
                                activityLevel: e.target.value,
                              })
                            }
                            className="w-full p-2 border border-gray-300 rounded-lg"
                          >
                            <option value="">Select activity level</option>
                            <option value="sedentary">
                              Sedentary (little to no exercise)
                            </option>
                            <option value="lightly_active">
                              Lightly active (light exercise 1-3 days/week)
                            </option>
                            <option value="moderately_active">
                              Moderately active (moderate exercise 3-5
                              days/week)
                            </option>
                            <option value="very_active">
                              Very active (hard exercise 6-7 days/week)
                            </option>
                            <option value="super_active">
                              Super active (very hard exercise & physical job or
                              2x training)
                            </option>
                          </select>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Action Buttons */}
                  <div className="flex gap-4 justify-center">
                    <button
                      type="submit"
                      disabled={!isFormValid()}
                      className={`px-8 py-3 rounded-lg font-semibold text-white transition-colors ${
                        isFormValid()
                          ? "bg-green-600 hover:bg-green-700"
                          : "bg-gray-400 cursor-not-allowed"
                      }`}
                    >
                      Calculate My Score
                    </button>
                    <button
                      type="button"
                      onClick={handleReset}
                      className="px-8 py-3 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors"
                    >
                      Reset
                    </button>
                  </div>
                </form>
              </div>

              {/* Results Section */}
              {results && (
                <div
                  id="results-section"
                  className="bg-white rounded-lg shadow-md p-6 mb-6"
                >
                  <h2 className="text-2xl font-bold text-gray-800 mb-6">
                    Your Results
                  </h2>

                  {/* Score Display */}
                  <div className="text-center mb-8">
                    <div className="text-6xl font-bold text-gray-800 mb-2">
                      {results.totalScore.toFixed(1)}/140
                    </div>
                    <div className="text-2xl text-gray-600 mb-2">
                      {results.percentage.toFixed(1)}% alignment
                    </div>
                    <div className="text-lg text-gray-500 mb-2">
                      {dietaryPattern === "balanced" &&
                        "Balanced (Flexitarian) Diet"}
                      {dietaryPattern === "pescatarian" && "Pescatarian Diet"}
                      {dietaryPattern === "vegetarian" && "Vegetarian Diet"}
                      {dietaryPattern === "vegan" && "Vegan Diet"}
                      {" ‚Ä¢ "}Compared to EAT-Lancet {dietaryPattern} guidelines
                    </div>

                    {/* EER Display */}
                    {results.eer && (
                      <div className="text-sm text-gray-600 mb-4">
                        {results.isDefaultEER ? (
                          <span>Using standard EER: 2,373 kcal/day</span>
                        ) : (
                          <div className="flex flex-col items-center gap-1">
                            <span className="font-semibold text-green-700">
                              ‚úì Your estimated daily energy needs:{" "}
                              {results.eer.toLocaleString()} kcal
                            </span>
                            <span className="text-gray-500">
                              Targets adjusted accordingly (scale factor:{" "}
                              {results.scaleFactor.toFixed(2)}√ó)
                            </span>
                            {results.isCapped && (
                              <span className="text-orange-600 text-xs mt-1">
                                ‚ö†Ô∏è Scale factor capped at{" "}
                                {results.scaleFactor === 0.5 ? "0.5" : "2.0"}√ó
                                for safety
                              </span>
                            )}
                          </div>
                        )}
                      </div>
                    )}

                    {/* Progress Bar */}
                    <div className="max-w-2xl mx-auto mb-4">
                      <div className="w-full bg-gray-200 rounded-full h-6">
                        <div
                          className={`h-6 rounded-full transition-all ${
                            results.percentage >= 75
                              ? "bg-green-600"
                              : results.percentage >= 60
                              ? "bg-yellow-500"
                              : "bg-red-500"
                          }`}
                          style={{
                            width: `${Math.min(100, results.percentage)}%`,
                          }}
                        ></div>
                      </div>
                    </div>

                    {/* Interpretation */}
                    <div
                      className={`text-xl p-4 rounded-lg mb-6 ${
                        results.percentage >= 75
                          ? "bg-green-100 text-green-800"
                          : results.percentage >= 60
                          ? "bg-yellow-100 text-yellow-800"
                          : "bg-red-100 text-red-800"
                      }`}
                    >
                      {results.interpretation}
                    </div>

                    {/* Export Options */}
                    <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                      <p className="text-sm font-semibold text-gray-700 mb-3">
                        üì§ Get Your Results for AI Coaching
                      </p>
                      <div className="flex flex-wrap gap-3">
                        <button
                          onClick={copyForLLM}
                          className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold text-sm transition-colors"
                        >
                          üìã Copy for Claude/ChatGPT
                        </button>
                        <button
                          onClick={exportForLLM}
                          className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold text-sm transition-colors"
                        >
                          üíæ Download as Text
                        </button>
                        <button
                          onClick={exportAsJSON}
                          className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-semibold text-sm transition-colors"
                        >
                          üìä Download as JSON
                        </button>
                      </div>
                      <p className="text-xs text-gray-500 mt-2">
                        Use the copied summary to get personalized coaching from
                        Claude or ChatGPT about improving your diet.
                      </p>
                    </div>
                  </div>

                  {/* Top Improvement Areas */}
                  {results.topImprovements.length > 0 && (
                    <div className="mb-8">
                      <h3 className="text-xl font-bold text-gray-800 mb-4">
                        Top Areas for Improvement
                      </h3>
                      <div className="space-y-3">
                        {results.topImprovements.map((item, index) => (
                          <div
                            key={index}
                            className={`p-4 rounded-lg ${getScoreBgColor(
                              item.score,
                              item.max
                            )}`}
                          >
                            <div className="flex items-start gap-3">
                              <span className="text-2xl">{item.emoji}</span>
                              <div className="flex-1">
                                <div className="flex justify-between items-center mb-1">
                                  <span className="font-semibold text-gray-800">
                                    {item.name}
                                  </span>
                                  <span
                                    className={`font-bold ${getScoreColor(
                                      item.score,
                                      item.max
                                    )}`}
                                  >
                                    {item.score.toFixed(1)}/{item.max}
                                  </span>
                                </div>
                                <p className="text-gray-700">{item.rec}</p>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Component Breakdown */}
                  <div>
                    <h3 className="text-xl font-bold text-gray-800 mb-4">
                      Complete Score Breakdown
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      {results.componentDetails.map((item, index) => (
                        <div
                          key={index}
                          className="p-3 bg-gray-50 rounded-lg flex justify-between items-center"
                        >
                          <span className="flex items-center gap-2">
                            <span className="text-xl">{item.emoji}</span>
                            <span className="text-gray-700">{item.name}</span>
                          </span>
                          <span
                            className={`font-bold ${getScoreColor(
                              item.score,
                              item.max
                            )}`}
                          >
                            {item.score.toFixed(1)}/{item.max}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {/* Settings Section */}
              <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 className="text-lg font-bold text-gray-800 mb-3">
                  Settings
                </h3>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-700 font-semibold">
                      Clear All Data
                    </p>
                    <p className="text-sm text-gray-500">
                      Delete all saved assessments from this browser
                    </p>
                  </div>
                  <button
                    onClick={clearAllData}
                    disabled={assessmentHistory.length === 0}
                    className={`px-4 py-2 rounded-lg font-semibold text-sm transition-colors ${
                      assessmentHistory.length > 0
                        ? "bg-red-600 hover:bg-red-700 text-white"
                        : "bg-gray-300 text-gray-500 cursor-not-allowed"
                    }`}
                  >
                    Clear Data
                  </button>
                </div>
              </div>

              {/* History Modal */}
              {showHistory && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden">
                    <div className="p-6 border-b border-gray-200">
                      <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-800">
                          Assessment History
                        </h2>
                        <button
                          onClick={() => setShowHistory(false)}
                          className="text-gray-500 hover:text-gray-700 text-2xl"
                        >
                          √ó
                        </button>
                      </div>
                    </div>
                    <div className="p-6 overflow-y-auto max-h-[calc(80vh-140px)]">
                      {assessmentHistory.length === 0 ? (
                        <p className="text-gray-500 text-center py-8">
                          No assessments yet
                        </p>
                      ) : (
                        <div className="space-y-4">
                          {[...assessmentHistory]
                            .reverse()
                            .map((assessment, index) => (
                              <div
                                key={assessment.id}
                                className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50"
                              >
                                <div className="flex justify-between items-start mb-2">
                                  <div>
                                    <p className="font-semibold text-gray-800">
                                      {new Date(
                                        assessment.timestamp
                                      ).toLocaleDateString()}{" "}
                                      at{" "}
                                      {new Date(
                                        assessment.timestamp
                                      ).toLocaleTimeString()}
                                    </p>
                                    <p className="text-sm text-gray-500">
                                      {assessmentHistory.length - index === 1
                                        ? "Latest"
                                        : assessmentHistory.length - index ===
                                          assessmentHistory.length
                                        ? "First assessment"
                                        : `${
                                            assessmentHistory.length - index
                                          } assessment${
                                            assessmentHistory.length - index !==
                                            1
                                              ? "s"
                                              : ""
                                          } ago`}
                                    </p>
                                  </div>
                                  <div className="text-right">
                                    <p className="text-2xl font-bold text-gray-800">
                                      {assessment.results.totalScore.toFixed(1)}
                                      /140
                                    </p>
                                    <p className="text-sm text-gray-600">
                                      {assessment.results.percentage.toFixed(1)}
                                      %
                                    </p>
                                  </div>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                  <div
                                    className={`h-2 rounded-full ${
                                      assessment.results.percentage >= 75
                                        ? "bg-green-600"
                                        : assessment.results.percentage >= 60
                                        ? "bg-yellow-500"
                                        : "bg-red-500"
                                    }`}
                                    style={{
                                      width: `${Math.min(
                                        100,
                                        assessment.results.percentage
                                      )}%`,
                                    }}
                                  ></div>
                                </div>
                                <p className="text-sm text-gray-600 mt-2">
                                  {assessment.results.interpretation}
                                </p>
                              </div>
                            ))}
                        </div>
                      )}
                    </div>
                    <div className="p-6 border-t border-gray-200 bg-gray-50">
                      <button
                        onClick={() => setShowHistory(false)}
                        className="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      ReactDOM.render(<PHDIQuestionnaire />, document.getElementById("root"));
    </script>
  </body>
</html>
